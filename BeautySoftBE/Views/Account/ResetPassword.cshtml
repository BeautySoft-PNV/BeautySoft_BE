@model BeautySoftBE.Application.DTOs.ResetPasswordRequest
@{
    ViewData["Title"] = "Đặt lại mật khẩu";
}

<h2>Đặt lại mật khẩu</h2>

<form id="resetPasswordForm">
    <input type="hidden" asp-for="Token" />
    <input type="hidden" asp-for="Email" />

    <div class="form-group">
        <label>Mật khẩu mới</label>
        <input asp-for="NewPassword" type="password" class="form-control" id="newPassword" required />
        <small class="text-danger" id="errorMessage"></small>
    </div>

    <button type="submit" class="btn btn-success mt-2">Đặt lại mật khẩu</button>
</form>

<div id="successMessage" class="alert alert-success mt-2 d-none"></div>

@section Scripts {
    <script>
        document.getElementById("resetPasswordForm").addEventListener("submit", async function (e) {
            e.preventDefault(); // Ngăn reload trang

            let formData = new FormData(this);
            let submitButton = this.querySelector("button");
            let token = document.getElementById("Token").value;
            submitButton.disabled = true; // Vô hiệu hóa button trong khi xử lý
            console.log(token)
            let response = await fetch("@Url.Action("ResetPassword", "Account")", {
                method: "POST",
                body: formData,
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            });

            let result = await response.json();
            submitButton.disabled = false; // Bật lại button

            if (!response.ok) {
                document.getElementById("errorMessage").innerText = result.message || "Có lỗi xảy ra!";
                document.getElementById("successMessage").classList.add("d-none");
            } else {
                document.getElementById("successMessage").innerText = result.message;
                document.getElementById("successMessage").classList.remove("d-none");
                document.getElementById("errorMessage").innerText = "";
            }
        });
    </script>
}